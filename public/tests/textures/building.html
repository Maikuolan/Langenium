<!DOCTYPE html>
<html>
	<head>
		<title>Initial drawing texture experiments</title>
	</head>
	<body>

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
		<script src="/scripts/shared/three.min.js"></script>
		<script src="/scripts/shared/OrbitControls.js"></script>
		<script src="/scripts/shared/stats.min.js"></script>
		<script src="/scripts/shared/SimplexNoise.js"></script>
		<script type='text/javascript'>

		var camera, scene, renderer, texture, controls;
			var mesh;

			init();
			animate();

			function init() {

				renderer = new THREE.WebGLRenderer({alpha: true});
				renderer.setSize( window.innerWidth, window.innerHeight );
				document.body.appendChild( renderer.domElement );

				camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000 );
				camera.position.z = 400;

				scene = new THREE.Scene();

				var geometry = new THREE.CubeGeometry( 100, 300, 100 );

				var canvas = draw_texture();

				texture = new THREE.Texture( canvas, THREE.UVMapping, THREE.RepeatWrapping, THREE.RepeatWrapping, THREE.NearestFilter, THREE.NearestFilter );
				texture.anisotropy  = renderer.getMaxAnisotropy();
				texture.needsUpdate = true;
				texture.repeat.set(1/3, 1)
				

				var material = new THREE.MeshLambertMaterial( { 
					map: texture ,
					vertexColors    : THREE.VertexColors
				} );

				mesh = new THREE.Mesh( geometry, material );
				scene.add( mesh );

				window.addEventListener( 'resize', onWindowResize, false );
				var ambientLight = new THREE.AmbientLight(0xFFFFFF);
			    scene.add(ambientLight);

			    controls = new THREE.OrbitControls( camera, renderer.domElement );

			}

			function onWindowResize() {

				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();

				renderer.setSize( window.innerWidth, window.innerHeight );

			}

			function animate() {

				requestAnimationFrame( animate );

				controls.update();

				renderer.render( scene, camera );

			}
 

			function draw_texture () {
				 // build a small canvas 32x64 and paint it in white
				  var canvas  = document.createElement( 'canvas' );
				  canvas.width = 32;
				  canvas.height    = 64;
				  var context = canvas.getContext( '2d' );
				  // plain it in white
				  context.fillStyle    = '#ffffff';
				  context.fillRect( 0, 0, 32, 64 );
				  // draw the window rows - with a small noise to simulate light variations in each room
				  for( var y = 2; y < 64; y += 2 ){
				      for( var x = 0; x < 32; x += 2 ){
				          var value   = Math.floor( Math.random() * 64 );
				          context.fillStyle = 'rgb(' + [value, value, value].join( ',' )  + ')';
				          context.fillRect( x, y, 2, 1 );
				      }
				  }

				  // build a bigger canvas and copy the small one in it
				  // This is a trick to upscale the texture without filtering
				  var canvas2 = document.createElement( 'canvas' );
				  canvas2.width    = 512;
				  canvas2.height   = 1024;
				  var context = canvas2.getContext( '2d' );
				  // disable smoothing
				  context.imageSmoothingEnabled        = false;
				  context.webkitImageSmoothingEnabled  = false;
				  context.mozImageSmoothingEnabled = false;
				  // then draw the image
				  context.drawImage( canvas, 0, 0, canvas2.width, canvas2.height );
				  // return the just built canvas2
				  return canvas2;
			}

			








			function setPixel(imageData, x, y, r, g, b, a) {
			    var index = (x + y * imageData.width) * 4;
			    imageData.data[index+0] = r;
			    imageData.data[index+1] = g;
			    imageData.data[index+2] = b;
			    imageData.data[index+3] = a;
			}
			//function getLastPixel
		</script>
	</body>
</html>